<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
  <title>Hello, world!</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto:wght@300;400;500;700;900&display=swap"
    rel="stylesheet">
  <!--fontawesome-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
    integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

  <link rel="stylesheet" href="build/toastr.min.css">

  <link rel="stylesheet" href="index.css">
</head>





<body>


  <div id="wrapper">
    <div class="overlay"></div>

    <!-- Sidebar -->
    <nav class="fixed-top align-top" id="sidebar-wrapper" role="navigation">
      <div class="simplebar-content" style="padding: 0px;">
        <a class="sidebar-brand" href="index.html">
          <span class="align-middle">Vishweb Design</span>
        </a>

        <ul class="navbar-nav align-self-stretch">

          <li class="sidebar-header">
            Pages
          </li>
          <li class="">
            <a class="nav-link text-left active" role="button" aria-haspopup="true" aria-expanded="false">
              <i class="flaticon-bar-chart-1"></i> Dashboard
            </a>
          </li>

          <li class="has-sub">
            <a class="nav-link collapsed text-left" href="#collapseExample2" role="button" data-toggle="collapse">
              <i class="flaticon-user"></i> Profile
            </a>
            <div class="collapse menu mega-dropdown" id="collapseExample2">
              <div class="dropmenu" aria-labelledby="navbarDropdown">
                <div class="container-fluid ">
                  <div class="row">
                    <div class="col-lg-12 px-2">
                      <div class="submenu-box">
                        <ul class="list-unstyled m-0">
                          <li><a href="">PHP Frameworks</a></li>
                          <li><a href="">Laravel</a></li>
                          <li><a href=""> Codeigniter</a></li>
                          <li><a href="">Node.js</a></li>
                          <li><a href="">AngularJS</a></li>
                          <li><a href="">ReactJS</a></li>
                          <!-- <li><a href="">Asp.net</a></li> -->
                        </ul>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </li>
          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-bar-chart-1"></i> setting
            </a>
          </li>

          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-bar-chart-1"></i> invoice
            </a>
          </li>
          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-bar-chart-1"></i> Bank
            </a>
          </li>
          <li class="sidebar-header">
            tools and component
          </li>

          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-bar-chart-1"></i> ui element
            </a>
          </li>

          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-bar-chart-1"></i> form
            </a>
          </li>
          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-bar-chart-1"></i> table
            </a>
          </li>

          <li class="sidebar-header">
            tools and component
          </li>
          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-bar-chart-1"></i> chart
            </a>
          </li>
          <li class="">
            <a class="nav-link text-left" role="button">
              <i class="flaticon-map"></i> map
            </a>
          </li>

        </ul>


      </div>


    </nav>
    <!-- /#sidebar-wrapper -->










    <!-- Page Content -->
    <div id="page-content-wrapper">


      <div id="content">

        <div class="container-fluid p-0 px-lg-0 px-md-0">
          <!-- Topbar -->
          <nav class="navbar navbar-expand navbar-light my-navbar py-3">

            <!-- Sidebar Toggle (Topbar) -->
            <div type="button" id="bar" class="nav-icon1 hamburger animated fadeInLeft is-closed"
              data-toggle="offcanvas">
              <span></span>
              <span></span>
              <span></span>
            </div>



            <!-- Topbar Navbar -->
            <ul class="navbar-nav ml-auto">



            </ul>

          </nav>
          <!-- End of Topbar -->

          <!-- Begin Page Content -->
          <div class="container-fluid px-lg-4">
            <div class="row">
              <div class="col-md-12 mt-lg-4 mt-4">
                <!-- Page Heading -->
                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                  <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>

                </div>
              </div>
              <div class="col-md-12">

                <!-- column -->
                <div class="col-md-12 mt-4">
                  <div class="card">
                    <div class="card-body">
                      <!-- title -->
                      <div class="d-md-flex align-items-center">
                        <div>
                          <h4 class="card-title">ALL EMPLOYEEE</h4>
                          <h5 class="card-subtitle">Overview of Employee</h5>
                        </div>
                        <div class="ml-auto">
                          <button class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">Create
                            Employee</button>

                          <!-- Modal -->
                          <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog  modal-lg">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="exampleModalLabel">Créer mon compte</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                  </button>
                                </div>
                                <div class="modal-body">
                                  <form id="myform">
                                    <div class="form-group">
                                      <input type="text" class="form-control" id="name" name="name" placeholder="Name">
                                    </div>
                                    <div class="form-group">
                                      <input type="text" class="form-control" id="cin" name="cin"
                                        placeholder="N° de carte nationale d'identité/Passeport/Séjour">
                                    </div>
                                    <div class="input-group mb-3">
                                      <input type="date" class="form-control" placeholder="Date de naissance"
                                        aria-label="Recipient's username" aria-describedby="basic-addon2"
                                        id="dateNaissance" name="dateNaissance">
                                      <div class="input-group-append">
                                        <span class="input-group-text" id="basic-addon2">(jj/mm/aaaa)</span>
                                      </div>
                                    </div>
                                    <div class="form-group">
                                      <input type="email" class="form-control" id="email" name="email"
                                        placeholder="Email" aria-describedby="emailHelp">
                                      <small id="emailHelp" class="form-text text-muted">(Email servira pour la
                                        confirmation de la création du compte)</small>
                                    </div>
                                    <div class="form-group">
                                      <input type="email" class="form-control" id="cemail"
                                        placeholder="Confirmer votre email">
                                      <small id="showErrorcEmail"></small>
                                    </div>
                                    <div class="form-group">
                                      <input type="text" class="form-control" id="phone" name="phone"
                                        onkeyup="validationPhone()" placeholder="N° Téléphone">
                                    </div>

                                    <div class="input-group mb-3">
                                      <input type="text" class="form-control" id="password" name="password"
                                        placeholder="" aria-label="Username" aria-describedby="basic-addon1" disabled>
                                      <div class="input-group-prepend">
                                        <div class="input-group-text" id="basic-addon1" onclick="getPassword()"><i
                                            class="fas fa-sync-alt"></i></div>
                                      </div>
                                    </div>

                                    <div class="form-group">
                                      <label for="exampleInputPassword1">Entrez les caractéres figurant l'image
                                        ci-dessus</label>
                                      <input type="text" class="form-control" id="cpassword">
                                      <small id="showErrorcPwd"></small>
                                    </div>

                                    <p class="font-weight-bold">Conformément à la loi 09-08, vous disposez d'un droit
                                      d'accées, de rectification et d'opposition au traitement de vos données
                                      personnélles. Ce traitement a été autoeisé par la CNDP sous le n°: A-W-292/2020
                                    </p>

                                    <div class="form-group form-check">
                                      <input type="checkbox" class="form-check-input" id="exampleCheck1">
                                      <small class="form-check-label" for="exampleCheck1">J'ai lu et j'accepte les
                                        conditions générales d'utilisation notamment la notion realtive à la protection
                                        des données personnelles</small>
                                    </div>

                                    <input type="button" value="Save" class="btn btn-primary btn-block" onclick="submitEmployee()" />

                                  </form>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- title -->
                    </div>
                    <div class="table-responsive">
                      <table class="table v-middle">
                        <thead>
                          <tr class="bg-light">
                            <th class="border-top-0">Name</th>
                            <th class="border-top-0">Email</th>
                            <th class="border-top-0">CIN</th>
                            <th class="border-top-0">Date Naissance</th>
                            <th class="border-top-0">Phone</th>
                          </tr>
                        </thead>
                        <tbody id="tbody">
                        

                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>


              </div>

            </div>
            <!-- /.container-fluid -->

          </div>

        </div>
      </div>
      <!-- /#page-content-wrapper -->

    </div>
    <!-- /#wrapper -->





    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous">
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="build/toastr.min.js"></script>

    <script>
      $('#bar').click(function () {
        $(this).toggleClass('open');
        $('#page-content-wrapper ,#sidebar-wrapper').toggleClass('toggled');

      });

      // Random Code 
      async function getPassword() {
        var chars = "ACBDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        var passwordLength = 6;
        var password = "";

        for (var i = 0; i < passwordLength; i++) {
          var randomNumber = Math.floor(Math.random() * chars.length);
          password += chars.substring(randomNumber, randomNumber + 1);

        }
        document.getElementById('password').value = await password
      }


      // Confirmation Code Confirmation
      $('#cpassword').keyup(function () {
        var password = $("#password").val()
        var cpassword = $('#cpassword').val()

        if (cpassword != password) {
          $('#showErrorcPwd').html('Code are not matching')
          $('#showErrorcPwd').css('color', 'red')
          return false
        } else {
          $('#showErrorcPwd').html('')
          return true
        }
      })

      // Confirmation Code Confirmation
      $('#cemail').keyup(function () {
        var password = $("#email").val()
        var cpassword = $('#cemail').val()

        if (cpassword != password) {
          $('#showErrorcEmail').html('Email are not matching')
          $('#showErrorcEmail').css('color', 'red')
          return false
        } else {
          $('#showErrorcEmail').html('')
          return true
        }
      })


      // Validation input phone by regex javascript
      function validationPhone() {
        const phone = document.getElementById('phone')
        // nettoyage
        const tel = phone.value.replace(/[\.,\s]/g, '');
        phone.style.backgroundColor = tel.match(/^(\+33|0033|0)(6|7)[0-9]{8}$/g) || tel.match(
          /^(\+212|0033|0)(6|7)[0-9]{8}$/g) ? 'lime' : 'red';
      };

      //  Create Employee use method POST in axios
      function submitEmployee() {

        const name = document.getElementById('name').value
        const email = document.getElementById('email').value
        const cin = document.getElementById('cin').value
        const password = document.getElementById('password').value
        const dateNaissance = document.getElementById('dateNaissance').value
        const phone = document.getElementById('phone').value

        axios.post('http://localhost:3000/api/employee/create', {
            name : name,
            email: email,
            cin: cin,
            password : password,
            dateNaissance: dateNaissance,
            phone: phone
        }).then(res => {
            if (res.error) {
              console.log(err.data);
            }
            toastr.success('Employee is Created !!')
            document.getElementById('myform').reset();
            console.log(res.data);
          }).catch(err => console.log(err))

      }

      // get All Employee use GET axios
         function getAllEmployee() {
          axios.get('http://localhost:3000/api/employee/allEmployee')
           .then(res => {
            const showData = document.getElementById('tbody')
            console.log(res.data.employee)

            res.data.map(item => {
              const html = `
                  <tr>
                      <td>
                              <div class="d-flex align-items-center">
                                <div class="m-r-10"><a class="btn btn-circle btn-info text-white">EA</a>
                                </div>
                                <div class="">
                                  <h4 class="m-b-0 font-16">${item.name}</h4>
                                </div>
                              </div>
                            </td>
                            <td>${item.email}</td>
                            <td>${item.cin}</td>
                            <td>${item.dateNaissance}</td>
                            <td>${item.phone}</td>
                    </tr>
              ` 
              showData.innerHTML += html
            })
           })
           .catch(err => console.log(err))
         }
         getAllEmployee()
    </script>

</body>

</html>